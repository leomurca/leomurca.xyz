<!DOCTYPE html>
<html lang="en-us"><head>
    <meta charset="utf-8" />
    <title>How to Access Test Only Files From Unit and Instrumented Test Packages | Leonardo Murça</title>
    <meta name="description" content="Leonardo Murça's Webpage" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Leonardo Murça" />
    
    
    
    <link rel="stylesheet" type="text/css" href="css/style.css" />
  </head><body>
        <div class="content"><header>
    <a class="main-title" href="localhost">
        <h1>Leonardo Murça</h1>
    </a>
</header>
<main>
    <article>
        <h1 class="title">How to Access Test Only Files From Unit and Instrumented Test Packages</h1>
		<section class="body">
			<h2 id="tldr">TL;DR</h2>
<p>Create a directory called <code>testCommon</code> and add the code below to your <code>build.gradle</code> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>android <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    sourceSets <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        test <span style="color:#f92672">{</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">srcDirs</span> <span style="color:#f92672">+=</span> src<span style="color:#e6db74">/testCommon }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        androidTest { java.srcDirs += src/</span>testCommon <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span></code></pre></div><hr>
<p>Have you ever been in a situation where you need to access util files from both <code>test</code>
and <code>androidTest</code> packages? If so, this article may be useful for you.</p>
<p>Let&rsquo;s say that you have a file called <code>Placeholders.kt</code> which you use its values
as <strong>test doubles</strong> for your unit tests.</p>
<p>Our test scenario in this case will be the <code>Success</code> return of the login method from an
use case class called <code>LoginUseCaseImpl</code>.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// test/Placeholders.kt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Placeholders</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">val</span> email = <span style="color:#e6db74">&#34;johndoe@email.com&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">val</span> password = <span style="color:#e6db74">&#34;strongpassword123&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// test/LoginUseCaseImplTest.kt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginUseCaseImplTest</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> loginUseCase = LoginUseCaseImpl()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">`when call login should return Success`</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Arrange
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> email = Placeholders.email
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> password = Placeholders.password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Act
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> result = loginUseCase.login(email, password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assert
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        assertEquals(Success, result)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now, we need to write <strong>Instrumented Tests</strong> using <a href="https://developer.android.com/training/testing/espresso/">Espresso</a>
to validate the complete login flow. The scenario is: when fill the email and password fields and tap the login button
then a success message will display.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// androidTest/LoginScreenInstrumentedTest.kt 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginScreenInstrumentedTest</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">when</span>_fill_the_email_and_password_fields_and_tap_the_login_button_then_a_success_message_will_display() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Arrange
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> email = Placeholders.email
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> password = Placeholders.password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// When fill email and password fields
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        onView(withId(R.id.email_field)).perform(ViewActions.typeText(email))
</span></span><span style="display:flex;"><span>        onView(withId(R.id.password_field)).perform(ViewActions.typeText(password))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// And tap the login button
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        onView(withId(R.id.login_button)).perform(ViewActions.click())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Then a success message will display.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        onView(withId(R.id.success_message)).check(matches(isDisplayed()))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>By default, the espresso test will be inside the <code>androidTest</code> package but our <code>Placeholders.kt</code>
is available only inside the <code>test</code> package, which our <code>LoginUseCaseImplTest</code> is also located.
So, the Instrumented Test above will not find the <code>Placeholders.kt</code>.</p>
<p>To allow both tests access the same file, we need to create a new package inside <code>src</code> which will place the <code>Placeholders.kt</code>.
In this example, we&rsquo;ll name it as <code>testCommon</code>. After that, we need to tell gradle to consider this new package
as a <code>test</code> and <code>androidTest</code> package. We will put the code below in our <code>build.gradle</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>android <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    sourceSets <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        test <span style="color:#f92672">{</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">srcDirs</span> <span style="color:#f92672">+=</span> src<span style="color:#e6db74">/testCommon }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        androidTest { java.srcDirs += src/</span>testCommon <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>That&rsquo;s it! Now both test packages will be able to access our <code>Placeholders.kt</code> file!</p>

		</section>
    </article>
</main>
<footer>
    <p>Copyright © 2022 Leonardo Murça.</p>
</footer></div>
    </body>
</html>